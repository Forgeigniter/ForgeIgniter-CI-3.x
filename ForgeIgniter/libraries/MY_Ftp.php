<?php
defined('BASEPATH') or exit('No direct script access allowed');
/**
 * CodeIgniter
 *
 * An open source application development framework for PHP 4.3.2 or newer
 *
 * @package		CodeIgniter
 * @author		ExpressionEngine Dev Team
 * @copyright	Copyright (c) 2008, EllisLab, Inc.
 * @license		http://codeigniter.com/user_guide/license.html
 * @link		http://codeigniter.com
 * @since		Version 1.0
 * @filesource
 */

// ------------------------------------------------------------------------

/**
 * FTP Class
 *
 * @package		CodeIgniter
 * @subpackage	Libraries
 * @category	Libraries
 * @author		ExpressionEngine Dev Team
 * @link		http://codeigniter.com/userguide2/libraries/ftp.html
 */
class MY_FTP extends CI_FTP
{

    /**
     * Read a directory and recreate it remotely
     *
     * This function recursively reads a folder and everything it contains (including
     * sub-folders) and creates a mirror via FTP based on it.  Whatever the directory structure
     * of the original file path will be recreated on the server.
     *
     * @access	public
     * @param	string	path to source with trailing slash
     * @param	string	path to destination - include the base folder with trailing slash
     * @return	bool
     */
    public function mirror($locpath, $rempath)
    {
        if (! $this->_is_conn()) {
            return false;
        }

        // Open the local file path
        if ($fp = @opendir($locpath)) {
            // Attempt to open the remote file path.
            if (! $this->changedir($rempath, true)) {
                // If it doesn't exist we'll attempt to create the direcotory
                if (! $this->mkdir($rempath) or ! $this->changedir($rempath)) {
                    return false;
                }
            }

            // Recursively read the local directory
            while (false !== ($file = readdir($fp))) {
                if (@is_dir($locpath.$file) && substr($file, 0, 1) != '.') {
                    $this->mirror($locpath.$file."/", $rempath.$file."/");
                } elseif ($file == ".htaccess") {
                    $this->upload($locpath.$file, $rempath.$file, 'ascii');
                } elseif (substr($file, 0, 1) != ".") {
                    // Get the file extension so we can se the upload type
                    $ext = $this->_getext($file);
                    $mode = $this->_settype($ext);

                    $this->upload($locpath.$file, $rempath.$file, $mode);
                }
            }
            return true;
        }

        return false;
    }
}
// END FTP Class

/* End of file Ftp.php */
/* Location: ./ForgeIgniter/libraries/MY_Ftp.php */
